# ═══════════════════════════════════════════════════════════════════════════════
# Dokku App Configuration
# ═══════════════════════════════════════════════════════════════════════════════
#
# Configuration for your Dokku app deployment.
# These settings are applied during the deployment workflow.
#
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────
# Resource Limits
# ─────────────────────────────────────────────────────────────────────────────
# Memory: 256m, 512m, 1g, 2g, etc.
# CPU: Number of cores (can be fractional, e.g., 0.5)
resources:
  memory: 512m
  cpu: 1

# ─────────────────────────────────────────────────────────────────────────────
# Health Check
# ─────────────────────────────────────────────────────────────────────────────
# Path that returns 200 OK when app is healthy
healthcheck:
  path: /health
  timeout: 30
  attempts: 5

# ─────────────────────────────────────────────────────────────────────────────
# Scaling
# ─────────────────────────────────────────────────────────────────────────────
# Number of web workers (dynos)
scale:
  web: 1
  # worker: 1  # Uncomment for background workers

# ─────────────────────────────────────────────────────────────────────────────
# Custom Domains
# ─────────────────────────────────────────────────────────────────────────────
# Additional domains for this app (requires DNS configuration)
# custom_domains:
#   - www.example.com
#   - api.example.com

# ─────────────────────────────────────────────────────────────────────────────
# Release Tasks
# ─────────────────────────────────────────────────────────────────────────────
# Commands to run after deploy, before health check
# Useful for database migrations, cache clearing, etc.
# If a task fails, the deployment is marked as failed.
#
# release:
#   tasks:
#     - name: "Database migrations"
#       command: "python manage.py migrate --no-input"
#       timeout: 120  # seconds (default: 120)
#     - name: "Clear cache"
#       command: "python manage.py clear_cache"
#       timeout: 30
#     - name: "Collect static files"
#       command: "python manage.py collectstatic --no-input"

# ─────────────────────────────────────────────────────────────────────────────
# Database Backups
# ─────────────────────────────────────────────────────────────────────────────
# Configure automatic backups for linked databases
#
# backup:
#   enabled: true
#   retention_days: 14
#   services:
#     - postgres
#     - mysql

# ─────────────────────────────────────────────────────────────────────────────
# Environment-Specific Overrides
# ─────────────────────────────────────────────────────────────────────────────
environments:
  production:
    resources:
      memory: 1g
      cpu: 2
    scale:
      web: 2

  staging:
    resources:
      memory: 512m
      cpu: 1

  preview:
    resources:
      memory: 256m
      cpu: 0.5
